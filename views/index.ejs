<!-- Victoria-Post-Viewing -->
<!-- Include the shared header partial (navigation, styles, etc.) -->
<%- include('partials/header') %>

<main class="container">
  <!-- Page header -->
  <div class="header-bar">
    <h1>All Posts</h1>
  </div>

  <!-- Show message if no posts exist -->
  <% if (posts.length === 0) { %>
    <p class="empty-state">No posts yet. Be the first to share your thoughts!</p>

  <% } else { %>
    <!-- Select the last post as featured -->
    <% const featured = posts[posts.length - 1]; %>
    <section class="featured-post">
      <h1>Featured Post</h1>
      <article class="post-item">
        <!-- Title and date -->
        <h2><a href="/posts/<%= featured.id %>"><%= featured.title %></a></h2>
        <small class="post-meta">Posted on <%= new Date(featured.createdAt).toLocaleDateString() %></small>

        <!-- Content preview -->
        <p>
          <%= featured.content.length > 200
            ? featured.content.substring(0, 200) + '…'
            : featured.content %>
        </p>

        <!-- Action buttons: Read More, Edit, Delete -->
        <div class="actions">
          <a href="/posts/<%= featured.id %>" class="btn btn-primary">Read More</a>
          <a href="/posts/<%= featured.id %>/edit" class="btn btn-primary">Edit</a>
          <form action="/posts/<%= featured.id %>/delete" method="POST" onsubmit="return confirm('Delete this post?');" style="display:inline;">
            <button type="submit" class="btn btn-danger">Delete</button>
          </form>
        </div>
      </article>
    </section>

    <!-- Display remaining posts in reverse order -->
    <section class="post-grid">
       <h1> Recent Posts</h1>
      <% posts.slice(0, -1).reverse().forEach(post => { %>
        <article class="post-item">
          <!-- Title and date -->
          <h2><a href="/posts/<%= post.id %>"><%= post.title %></a></h2>
          <small class="post-meta">Posted on <%= new Date(post.createdAt).toLocaleDateString() %></small>

          <!-- Content preview -->
          <p>
            <%= post.content.length > 150
              ? post.content.substring(0, 150) + '…'
              : post.content %>
          </p>

          <!-- Action buttons: Read More, Edit, Delete -->
          <div class="actions">
            <a href="/posts/<%= post.id %>" class="btn btn-primary">Read More</a>
            <a href="/posts/<%= post.id %>/edit" class="btn btn-primary">Edit</a>
            <form action="/posts/<%= post.id %>/delete" method="POST" onsubmit="return confirm('Delete this post?');" style="display:inline;">
              <button type="submit" class="btn btn-danger">Delete</button>
            </form>
          </div>
        </article>
      <% }) %>
    </section>
  <% } %>
</main>

<!-- Include the shared footer partial -->
<%- include('partials/footer') %>



