<!-- Victoria-Post-Viewing -->
<!-- Include the shared header partial (navigation, styles, etc.) -->
<%- include('partials/header') %>

<!-- Flash message for successful actions -->
<% if (successMessage) { %>
  <div id="popup-message" class="popup-success"><%= successMessage %></div>
<% } %>

<main class="container">

  <!-- Success message after deletion -->
  <% if (msg) { %>
    <div class="alert alert-success">
      <%= msg %>
    </div>
  <% } %>
  
  <!-- Page header -->
  <div class="header-bar">
    <h1>All Posts</h1>
  </div>

  <!-- Show message if no posts exist -->
  <% if (posts.length === 0) { %>
    <p class="empty-state">No posts yet. Be the first to share your thoughts!</p>

  <% } else { %>
    <!-- Select the first post as featured (newest first) -->
    <% const featured = posts[0]; %>
    <section class="featured-post">
      <h1>Featured Post</h1>
      <article class="post-item">
        <!-- Title and date -->
        <h2><a href="/posts/<%= featured.id %>"><%= featured.title %></a></h2>
        <small class="post-meta">
          Posted on <%= new Date(featured.createdAt).toLocaleString('en-GB', {
            day: 'numeric',
            month: 'long',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          }) %>
        </small>



        <!-- Content preview -->
        <p class="post-content1">
          <%= featured.content.length > 200
            ? featured.content.substring(0, 200) + '…'
            : featured.content %>
        </p>

        <!-- Action buttons: Read More, Edit, Delete -->
        <div class="actions">
          <a href="/posts/<%= featured.id %>" class="btn btn-primary">Read More</a>
          <a href="/posts/<%= featured.id %>/edit" class="btn btn-primary">Edit</a>
          <button type="button" class="btn btn-danger" onclick="openDeleteModal('<%= featured.id %>')">Delete</button>
        </div>
      </article>

    </section>

    <!-- Display remaining posts (excluding featured) -->
    <section class="post-grid">
      <h1>Recent Posts</h1>
      <% posts.slice(1).forEach(post => { %>
        <article class="post-item">
          <!-- Title and date -->
          <h2><a href="/posts/<%= post.id %>"><%= post.title %></a></h2>
          <small class="post-meta">
            Posted on <%= new Date(post.createdAt).toLocaleString('en-GB', {
              day: 'numeric',
              month: 'long',
              year: 'numeric',
              hour: '2-digit',
              minute: '2-digit'
            }) %>
          </small>


          <!-- Content preview -->
          <p class="post-content1">
            <%= post.content.length > 150
              ? post.content.substring(0, 150) + '…'
              : post.content %>
          </p>

          <!-- Action buttons: Read More, Edit, Delete -->
          <div class="actions">
            <a href="/posts/<%= post.id %>" class="btn btn-primary">Read More</a>
            <a href="/posts/<%= post.id %>/edit" class="btn btn-primary">Edit</a>
            <button type="button" class="btn btn-danger" onclick="openDeleteModal('<%= post.id %>')">Delete</button>
          </div>

        </article>
      <% }) %>
    </section>
  <% } %>
</main>

<!-- Delete confirmation modal -->
<div id="delete-modal" class="modal hidden">
  <div class="modal-content">
    <h2>Confirm Deletion</h2>
    <p>Are you sure you want to delete this post?</p>
    <form id="delete-form" method="POST">
      <button type="submit" class="btn btn-danger">Yes, Delete</button>
      <button type="button" class="btn btn-primary" onclick="closeDeleteModal()">Cancel</button>
    </form>
  </div>
</div>


<!-- Script for UI behaviors -->
<script src="/js/script.js"></script>

<!-- Include the shared footer partial -->
<%- include('partials/footer') %>
